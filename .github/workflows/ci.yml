name: CI

on: [push, pull_request]

jobs:
  build-test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - uses: php-actions/composer@v6
    
    - name: Set up PHP
      run: sudo apt-get update && sudo apt-get install -y php-sockets
    
    - name: Phpstan
      uses: php-actions/phpstan@v3
      with:
        path: src/
    
    - name: Psalm
      uses: docker://ghcr.io/psalm/psalm-github-actions

    - name: PHPUnit tests
      uses: graychen/phpunit-action@v1.0.0
      with:
        config: phpunit.xml